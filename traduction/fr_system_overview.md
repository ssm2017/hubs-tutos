source : https://hubs.mozilla.com/docs/system-overview.html
(Depuis Discord)

Notre topologie r√©seau est un peu bizarre. Nous avons deux services backend impliqu√©s dans les communications utilisateur-utilisateur. Un est reticulum qui est un reseau maill√© de noeuds erlang/elixir/phienix et qui est responsable de tout le traffic non voix/audio/video entre les utilisateurs. Quand vous vous connectez √† une salle, vous vous connectez par websockets √† un noeud d'equilibrage de charge de ce maillage et les messages sont relay√©s entre tous les utilisateurs dans cette pi√®ce √† travers le maillage par un systeme de pub/sub appel√© les canaux phoenix. Entre temps, pour la voix et la video, vous √™tes aussi connect√© √† un node partag√© SFU ex√©cutant Janus et notre plugin Janus (donc tous les utilisateurs sont connect√©s dans une salle au m√™me noeud physique pour le relais de la voix/video). Il n'y a pas de trafic p2p. Tout ce qui est op√©rationnel est captur√© dans notre d√©pot ops. 

Notre r√©seau de jeu lui m√™me est impl√©ment√© en utilisant la librairie networked-aframe. Actuellement, les autorisations et autentifications sont forc√©es dans un sous ensemble de messages tres petits comme le raccordement ou l'ejection mais la possibilit√© existe de faire des autorisations au niveau du message. Toutefois toute la simulation est faite cot√© client -- il n'y a pas de simulation cot√© serveur de quelque sorte que ce soit (comme la physique) -- les serveurs sont basiquement juste un bus de messages que les clients utilisent et qui font de legeres modifications et autorisations aux messages tout au long du processus avant d'etre distribu√© √† tous les participants. Des choses comme la propri√©t√© des objets et autre choses incidentes concernant l'orchestration de l'exp√©rience in-game entre les pairs est enti√®rement bas√© sur l'impl√©mentation du protocole client.

Pour l'etat persistant, nous ne faisons rien de fantaisiste. Nous avons une base de donn√©es postgresql derriere reticulum et un systeme de fichiers pour les deux methodes de stockage durable. Reticulum g√®re les deux et quand vous mettez √† jour un √©tat permanent de salle, epinglez des objets, etc... vous interf√©rez avec les API dans reticulum pour mettre √† jour les bits sur ces deux stockages. 

Notre s√©rialisation reseau est... quelque peu embarassante.... JSON. (et quelque part remarquable quand on considere que cela fonctionne bien en pratique actuellement)

Tous les assets sont stock√©s dans le systeme de fichiers et chiffr√©s avec une clef √† utilisation unique. Les fichiers sont servis par reticulum qui est devanc√© par un CDN pour le cache.

Entre parentheses, nous utilisons EFS sur AWS pour le systeme de fichiers mais cette approche est bonne par le fait que cela ne couple pas le service avec un autre service AWS. Actuellement, nous avons un seul couplage tendu AWS -- le nouveau service de screenshots qui est un script lambda qui est utilis√© pour g√©n√©rer les miniatures quand vous posez une url arbitraire dans hubs. Aussi, tous nos scripts admin terraform sont bas√©s sur AWS mais le code en lui m√™me ne n√©cessite pas (par exemple) de service AWS pour fonctionner et ne necessitent pas non plus de cr√©diter AWS.

Nous ex√©cutons une simulation de physique "r√©elle" sur chaque client et la majeure diff√©rence entre les clients est que chaque client est responsable de la simulation de chaque objet qu'on lui donne plutot que de recevoir des messages pour cet objet. Nous avons un algorithme basique de transfert de propri√©t√© qui est responsable de la convergence vers un propri√©taire (faites remonter les bugs :)) Il peut y avoir de courtes p√©riodes pendant lesquelles il peut y avoir un conflit car la propri√©t√© devrait converger sur tous les clients pour un objet donn√©. Toutefois, notre impl√©mentation r√©seau n'est pas √©labor√©e pour des cas d'utilisation comme votre FPS pr√©f√©r√© ou des mecaniques de jeu sensibles -- je serais bien surpris si quelqu'un pouvait obtenir un jeu basique comme cela avec hubs mais vous ne voudriez pas le voir en competition üòÉ Par exemple, nos clients ne sont pas pour l'adversit√© et sont (g√©n√©ralement) confiants entre eux -- une supposition saine pour notre cas d'utilisation est celle pendant laquelle vous partagez d√©j√† des liens de salles avec des personnes de confiance (et la faille dans un client hack√© esssayant d'effectuer des abus, vous avez la possibilit√© de l'√©jecter etc...) tandis que pour les jeux typiques un client hack√© est souvent d√©guis√© pour paraitre comme les autres personnes except√© le fait qu'il a certains avantages sur les autres, etc... nous n'√©laborrons pas de m√©diation pour ce genre de choses car il n'y a pas de concept de "game advantage" dans hubs etc.
